<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet author="chriszhu" id = "1" context="PREDEPLOY">
        <sql><![CDATA[
                create table user_order (
                    order_id bigint not null,
                    user_id bigint not null,
                    order_status_id smallint not null,
                    is_tentative boolean not null,
                    order_type_id smallint not null,
                    country varchar(2) not null,
                    currency varchar(3) not null,
                    shipping_method_id bigint default null,
                    shipping_address_id bigint default null,
                    total_amount decimal not null,
                    total_tax decimal not null,
                    is_tax_inclusive boolean not null,
                    total_discount decimal not null,
                    total_shipping_fee decimal not null,
                    total_shipping_fee_discount decimal not null,
                    honor_until_time timestamp default null,
                    honored_time timestamp not null,
                    properties varchar(4000) default null,
                    created_time timestamp not null,
                    created_by varchar(128) not null,
                    updated_time timestamp not null,
                    updated_by varchar(128) not null,
                    primary key (order_id)
                );
                create unique index user_order_index on user_order (user_id, order_id);
                create unique index user_order_time_index on user_order (user_id, order_id, updated_time, created_time);

                create table order_event (
                    event_id bigint not null,
                    action_id smallint not null,
                    status_id smallint not null,
                    created_time timestamp not null,
                    created_by varchar(128) not null,
                    updated_time timestamp not null,
                    updated_by varchar(128) not null,
                    order_id bigint not null,
                    tracking_uuid uuid not null,
                    event_tracking_uuid uuid not null,
                    flow_name varchar(128) default null,
                    primary key (event_id)
                );
                create unique index order_event_order_id_event_tracking_uuid on order_event (order_id, event_tracking_uuid);
                create index order_event_tracking_uuid on order_event (tracking_uuid);

                create table order_item (
                    order_item_id bigint not null,
                    order_id bigint not null,
                    order_item_type smallint not null,
                    product_item_id varchar(128) not null,
                    unit_price decimal not null,
                    quantity int not null,
                    shipping_method_id bigint default null,
                    shipping_address_id bigint default null,
                    total_amount decimal not null,
                    total_tax decimal not null,
                    is_tax_exempted boolean not null,
                    total_discount decimal not null,
                    honor_until_time timestamp default null,
                    honored_time timestamp not null,
                    properties varchar(4000) default null,
                    is_deleted boolean not null,
                    created_time timestamp not null,
                    created_by varchar(128) not null,
                    updated_time timestamp not null,
                    updated_by varchar(128) not null,
                    primary key (order_item_id)
                );
                create unique index item_order_time_index on order_item (order_item_id, order_id, updated_time, created_time);

                create table order_discount_info (
                    order_item_discount_info_id bigint not null,
                    order_id bigint not null,
                    order_item_id bigint default null,
                    discount_type smallint not null,
                    discount_rate decimal default null,
                    discount_amount decimal not null,
                    coupon varchar(128) default null,
                    promotion_id varchar(128) default null,
                    is_deleted boolean not null,
                    created_time timestamp not null,
                    created_by varchar(128) not null,
                    updated_time timestamp not null,
                    updated_by varchar(128) not null,
                    primary key (order_item_discount_info_id)
                );
                create unique index discount_order_index on order_discount_info (order_item_discount_info_id, order_id);

                create table order_billing_event (
                    event_id bigint not null,
                    action_id smallint not null,
                    status_id smallint not null,
                    created_time timestamp not null,
                    created_by varchar(128) not null,
                    updated_time timestamp not null,
                    updated_by varchar(128) not null,
                    order_id bigint not null,
                    balance_id varchar(128) not null,
                    primary key (event_id)
                );
                create unique index event_order_balance_time_index on order_billing_event (event_id, order_id, balance_id, updated_time);

                create table order_item_fulfillment_event (
                    event_id bigint not null,
                    action_id smallint not null,
                    status_id smallint not null,
                    created_time timestamp not null,
                    created_by varchar(128) not null,
                    updated_time timestamp not null,
                    updated_by varchar(128) not null,
                    order_id bigint not null,
                    order_item_id bigint not null,
                    tracking_uuid uuid not null,
                    fulfillment_id varchar(128) not null,
                    primary key (event_id)
                );
                create unique index fulfillment_event_order_item_time_index on order_item_fulfillment_event (event_id, order_id, order_item_id, updated_time);
                create unique index fulfillment_event_tracking_uuid_index on order_item_fulfillment_event (event_id, tracking_uuid);

                create table order_item_preorder_info (
                    order_item_preorder_info_id bigint not null,
                    order_item_id bigint not null,
                    billing_time timestamp not null,
                    pre_notification_time timestamp default null,
                    release_time timestamp not null,
                    created_time timestamp not null,
                    created_by varchar(128) not null,
                    updated_time timestamp not null,
                    updated_by varchar(128) not null,
                    primary key (order_item_preorder_info_id)
                );
                create unique index preorder_info_order_item_time_index on order_item_preorder_info (order_item_preorder_info_id, order_item_id, billing_time, pre_notification_time, release_time);
                create unique index preorder_info_time_index on order_item_preorder_info (order_item_preorder_info_id, created_time, updated_time);

                create table order_item_preorder_event (
                    event_id bigint not null,
                    action_id smallint not null,
                    status_id smallint not null,
                    created_time timestamp not null,
                    created_by varchar(128) not null,
                    updated_time timestamp not null,
                    updated_by varchar(128) not null,
                    order_item_id bigint not null,
                    primary key (event_id)
                );
                create unique index event_order_item_time_index on order_item_preorder_event (event_id, order_item_id, updated_time);

                create table order_item_preorder_update_history (
                    order_item_preorder_update_history_id bigint not null,
                    order_item_id bigint not null,
                    update_type_id smallint not null,
                    update_column varchar(128) not null,
                    update_before_value varchar(128) not null,
                    update_after_value varchar(128) not null,
                    updated_time timestamp not null,
                    updated_by varchar(128) not null,
                    primary key (order_item_preorder_update_history_id)
                );
                create unique index history_order_item_time_index on order_item_preorder_update_history (order_item_preorder_update_history_id, order_item_id, updated_time);

                create table order_item_tax_info (
                    order_item_tax_info_id bigint not null,
                    order_item_id bigint not null,
                    total_tax decimal not null,
                    tax_code varchar(128) not null,
                    is_tax_inclusive boolean not null,
                    is_tax_exempt boolean not null,
                    created_time timestamp not null,
                    created_by varchar(128) not null,
                    updated_time timestamp not null,
                    updated_by varchar(128) not null,
                    primary key (order_item_tax_info_id)
                );
                create unique index tax_item_time_index on order_item_tax_info (order_item_tax_info_id, order_item_tax_info_id, created_time, updated_time);

                create table order_payment_info (
                    order_payment_info_id bigint not null,
                    order_id bigint not null,
                    payment_method_id varchar(128) not null,
                    payment_method_type varchar(128) not null,
                    is_deleted boolean not null,
                    created_time timestamp not null,
                    created_by varchar(128) not null,
                    updated_time timestamp not null,
                    updated_by varchar(128) not null,
                    primary key (order_payment_info_id)
                );
                create unique index payment_order_index on order_payment_info (order_payment_info_id, order_payment_info_id, payment_method_id);
                create unique index payment_time_index on order_payment_info (order_payment_info_id, created_time, updated_time);

                create table subledger (
                    subledger_id bigint not null,
                    seller_id bigint not null,
                    seller_tax_profile_id bigint default null,
                    currency_id smallint not null,
                    total_amount decimal not null,
                    property varchar(4000) default null,
                    created_time timestamp not null,
                    created_by varchar(128) not null,
                    updated_time timestamp not null,
                    updated_by varchar(128) not null,
                    primary key (subledger_id)
                );

                create table subledger_event (
                    event_id bigint not null,
                    action_id smallint not null,
                    status_id smallint not null,
                    created_time timestamp not null,
                    created_by varchar(128) not null,
                    updated_time timestamp not null,
                    updated_by varchar(128) not null,
                    subledger_id bigint not null,
                    primary key (event_id)
                );

                create table subledger_item (
                    subledger_item_id bigint not null,
                    subledger_id bigint not null,
                    order_item_id bigint not null,
                    original_subledger_item_id bigint default null,
                    total_amount decimal not null,
                    created_time timestamp not null,
                    created_by varchar(128) not null,
                    updated_time timestamp not null,
                    updated_by varchar(128) not null,
                    primary key (subledger_item_id)
                );

                create table subledger_item_event (
                    event_id bigint not null,
                    action_id smallint not null,
                    status_id smallint not null,
                    created_time timestamp not null,
                    created_by varchar(128) not null,
                    updated_time timestamp not null,
                    updated_by varchar(128) not null,
                    subledger_item_id bigint not null,
                    primary key (event_id)
                );

                ]]>
        </sql>
    </changeSet>

</databaseChangeLog>