<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">


    <changeSet id="1" author='WenhongZhu' context="PREDEPLOY">
        <sql>
        <![CDATA[
            create table token_set_status
                (
                  set_status_id         smallint            not null,
                  description           varchar(32)             null,
                  created_time          date                    null,
                  created_by            varchar(64)             null,

                  constraint set_status_id_pk primary key (set_status_id)
                );
        ]]>
        </sql>
    </changeSet>
	
	<changeSet id="2" author='WenhongZhu' context="PREDEPLOY">
        <sql>
        <![CDATA[
            create table token_length
                (
                  token_length_id       smallint            not null,
                  description           varchar(32)             null,
                  created_time          date                    null,
                  created_by            varchar(64)             null,

                  constraint token_length_id_pk primary key (token_length_id)
                );
        ]]>
        </sql>
    </changeSet>
	
	
	<changeSet id="3" author='WenhongZhu' context="PREDEPLOY">
        <sql>
        <![CDATA[
            create table token_set
                (
                  token_set_id                    bigint           not null,
				  description                     varchar(128)         null,
                  token_set_status                smallint         not null,
                  generation_length               smallint             null,
                  generation_seed                 bigint               null,                  
                  created_time                    date             not null,
                  created_by                      varchar(64)          null,
				  updated_time                    date                 null,
                  updated_by                      varchar(64)          null,

                  constraint token_set_id_pk primary key (token_set_id),
				  constraint token_set_status_fk foreign key (token_set_status)
                      references token_set_status (set_status_id) match simple
                      on update no action on delete no action,
			      constraint generation_length_fk foreign key (generation_length)
                      references token_length (token_length_id) match simple
                      on update no action on delete no action
                );
        ]]>		
        </sql>
    </changeSet>
	
	<changeSet id="4" author='WenhongZhu' context="PREDEPLOY">
        <sql>
        <![CDATA[
            create table token_order_status
                (
                  order_status_id       smallint            not null,
                  description           varchar(32)             null,
                  created_time          date                    null,
                  created_by            varchar(64)             null,

                  constraint order_status_id_pk primary key (order_status_id)
                );
        ]]>
        </sql>
    </changeSet>
	
	<changeSet id="5" author='WenhongZhu' context="PREDEPLOY">
        <sql>
        <![CDATA[
            create table create_method
                (
                  create_method_id      smallint            not null,
                  description           varchar(32)             null,
                  created_time          date                    null,
                  created_by            varchar(64)             null,

                  constraint create_method_id_pk primary key (create_method_id)
                );
        ]]>
        </sql>
    </changeSet>

    <changeSet id="6" author='WenhongZhu' context="PREDEPLOY">
        <sql>
        <![CDATA[
            create table token_order
                (
                  token_order_id                    bigint              not null,
				  description                       varchar(32)         not null, 
				  token_set_id                      bigint              not null,
				  token_order_status                smallint            not null,
				  expired_time                      date                    null,
				  usage_limit                       bigint                  null,                  
                  creation_method                   smallint            not null,
                  quantity                          int                 not null,
				  activation                        varchar(10)             null,
				  created_time                      date                not null,
                  created_by                        varchar(64)             null,
				  updated_time                      date                    null,
                  updated_by                        varchar(64)             null,                      

                  constraint token_order_id_pk primary key (token_order_id),
				  constraint token_order_status_fk foreign key (token_order_status)
                      references token_order_status (order_status_id) match simple
                      on update no action on delete no action,
			      constraint creation_method_fk foreign key (creation_method)
                      references create_method (create_method_id) match simple
                      on update no action on delete no action
                );
        ]]>
        </sql>
    </changeSet>
	

	<changeSet id="7" author='WenhongZhu' context="PREDEPLOY">
        <sql>
        <![CDATA[
            create table token_item_status
                (
                  item_status_id            smallint            not null,
                  description               varchar(32)             null,
                  created_time              date                    null,
                  created_by                varchar(64)             null,

                  constraint item_status_id_pk primary key (item_status_id)
                );
        ]]>
        </sql>
    </changeSet>
	
	
    <changeSet id="8" author='WenhongZhu' context="PREDEPLOY">
        <sql>
        <![CDATA[
            create table token_item
                (                  
                  hash_value                    bigint              not null,
				  order_id                      bigint              not null,
                  token_item_status             smallint            not null,
				  disable_reason                varchar(512)            null,
                  created_time                  date                not null,
                  created_by                    varchar(64)             null,
				  updated_time                  date                    null,
                  updated_by                    varchar(64)             null, 

                  constraint hash_value_pk primary key (hash_value),
				  constraint token_order_status_fk foreign key (token_item_status)
                      references token_item_status (item_status_id) match simple
                      on update no action on delete no action,
				  constraint order_id_fk foreign key (order_id)
                      references token_order (token_order_id) match simple
                      on update no action on delete no action
                );
        ]]>
        </sql>
    </changeSet>
	

	<changeSet id="9" author='WenhongZhu' context="PREDEPLOY">
        <sql>
        <![CDATA[
            create table token_set_offer
                (
                  set_offer_id                  bigint              not null,
                  set_id                        bigint              not null,
				  product_id                    bigint              not null,
                  product_type                  varchar(16)             null,                  
                  created_time                  date                not null,
                  created_by                    varchar(64)             null,
				  updated_time                  date                    null,
                  updated_by                    varchar(64)             null, 

                  constraint set_offer_id_pk primary key (set_offer_id),
				  constraint token_set_offer_set_id_fk foreign key (set_id)
                      references token_set (token_set_id) match simple
                      on update no action on delete no action
                );
        ]]>
        </sql>
    </changeSet>
    

    <changeSet id="10" author='WenhongZhu' context="PREDEPLOY">
        <sql>
        <![CDATA[
            create table token_consumption
                (
                  consumption_id            bigint              not null,
                  hash_value                bigint              not null,
                  products                  varchar(1024)             null,
                  user_id                   bigint              not null,                  
                  created_time              date                not null,
                  created_by                varchar(64)             null,    
                  updated_time              date                    null,
                  updated_by                varchar(64)             null, 				  

                  constraint consumption_id_pk primary key (consumption_id),
				  constraint token_consumption_item_hash_fk foreign key (hash_value)
                      references token_item (hash_value) match simple
                      on update no action on delete no action				  
                );
        ]]>
        </sql>
    </changeSet>


    <changeSet id="31" author='WenhongZhu' context="PREDEPLOY">
        <sql>
        <![CDATA[
            insert into token_set_status values (0, 'ACTIVE', '2014-02-10','wenhongzhu'),
                                           (1, 'DISABLE', '2014-02-10','wenhongzhu');
        ]]>
        </sql>
    </changeSet>
	
	<changeSet id="32" author='WenhongZhu' context="PREDEPLOY">
        <sql>
        <![CDATA[
            insert into token_length values (0, 'LEN16', '2014-02-10','wenhongzhu'),
			                                (1, 'LEN20', '2014-02-10','wenhongzhu'),
                                            (2, 'LEN25', '2014-02-10','wenhongzhu');
        ]]>
        </sql>
    </changeSet>
	
	<changeSet id="33" author='WenhongZhu' context="PREDEPLOY">
        <sql>
        <![CDATA[
            insert into token_order_status values (0, 'PENDING', '2014-02-10','wenhongzhu'),
			                                (1, 'PROCESSING', '2014-02-10','wenhongzhu'),
											(2, 'COMPLETE', '2014-02-10','wenhongzhu'),
                                            (3, 'COMPLETE_WITH_ERROR', '2014-02-10','wenhongzhu');
        ]]>
        </sql>
    </changeSet>

	<changeSet id="34" author='WenhongZhu' context="PREDEPLOY">
        <sql>
        <![CDATA[
            insert into token_item_status values (0, 'ACTIVE', '2014-02-10','wenhongzhu'),
			                                (1, 'DEACTIVATED', '2014-02-10','wenhongzhu'),
											(2, 'BLACKLISTED', '2014-02-10','wenhongzhu'),
                                            (3, 'USED', '2014-02-10','wenhongzhu');
        ]]>
        </sql>
    </changeSet>
	
	<changeSet id="34" author='WenhongZhu' context="PREDEPLOY">
        <sql>
        <![CDATA[
            insert into create_method values (0, 'GENERATE', '2014-02-10','wenhongzhu'),
			                                (1, 'UPLOAD', '2014-02-10','wenhongzhu');											;
        ]]>
        </sql>
    </changeSet>

</databaseChangeLog>