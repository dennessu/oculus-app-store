<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="1" author='FenglinYu' context="PREDEPLOY">
        <sql><![CDATA[
            create table ewallet (
              id bigint not null,
              user_id bigint not null,
              type smallint not null,
              status smallint not null,
              currency varchar(128) not null,
              balance numeric not null,
              created_time timestamp not null,
              created_by varchar(256) not null,
              modified_time timestamp,
              modified_by varchar(256),
              tracking_uuid uuid UNIQUE,
              primary key (id)
            );

            create table ewallet_status (
              id int not null,
              name varchar(64) not null,
              created_by varchar(32) not null,
              created_time timestamp not null,
              primary key (id)
            );

            insert into ewallet_status values( 1, 'Active', '', '2014-01-10');
            insert into ewallet_status values( 2, 'Locked', '', '2014-01-10');
            insert into ewallet_status values( 3, 'Expired', '', '2014-01-10');

            create table ewallet_lot (
              id bigint not null,
              ewallet_id bigint not null,
              type smallint not null,
              total numeric not null,
              remaining numeric not null,
              expiration_date timestamp,
              created_time timestamp not null,
              created_by varchar(256) not null,
              modified_time timestamp,
              modified_by varchar(256),
              primary key (id)
            );

            create table lot_type (
              id int not null,
              name varchar(64) not null,
              created_by varchar(32) not null,
              created_time timestamp not null,
              primary key (id)
            );

            insert into lot_type values( 1, 'CASH', '', '2014-01-10');
            insert into lot_type values( 2, 'PROMOTION', '', '2014-01-10');

            create table transaction (
              id bigint not null,
              ewallet_id bigint not null,
              type int not null,
              amount numeric not null,
              offer_id bigint,
              created_time timestamp not null,
              created_by varchar(256) not null,
              primary key (id)
            );

            create table transaction_type (
              id int not null,
              name varchar(64) not null,
              created_by varchar(32) not null,
              created_time timestamp not null,
              primary key (id)
            );

            insert into transaction_type values( 1, 'Create', '', '2014-01-10');
            insert into transaction_type values( 2, 'Credit', '', '2014-01-10');
            insert into transaction_type values( 3, 'Debit', '', '2014-01-10');
            insert into transaction_type values( 4, 'Delete', '', '2014-01-10');
            

            create table lot_transaction (
              id bigint not null,
              ewallet_id bigint not null,
              ewallet_lot_id bigint not null,
              transaction_id bigint not null,
              type int not null,
              amount numeric,
              created_time timestamp not null,
              created_by varchar(256) not null,
              primary key (id)
            );
            
            ]]>
        </sql>
    </changeSet>

</databaseChangeLog>