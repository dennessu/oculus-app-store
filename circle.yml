general:
  branches:
    only:
      - master
      - release

machine:
  java:
    version: oraclejdk7
  services:
    - docker

# checkout:

dependencies:
  pre:
    - wget -q -O /tmp/gradle-2.1-bin.zip https://services.gradle.org/distributions/gradle-2.1-bin.zip
    - sudo unzip /tmp/gradle-2.1-bin.zip -d /opt/
    - sudo ln -s /opt/gradle-2.1/bin/gradle /usr/bin/gradle
  cache_directories:
    - ~/.m2
  override:
    - docker info

database:
  override:
    - ./setupdb.sh
  post:
    - GRADLE_OPTS="$GRADLE_OPTS -Xmx512m -XX:MaxPermSize=256m" ./build.sh -x build --parallel-threads=1
    - ./dataloader.sh

test:
  override:
    - ./test.sh -r

#deployment:
