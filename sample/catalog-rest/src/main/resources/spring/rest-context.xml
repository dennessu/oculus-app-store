<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

    <bean id="commonResource" class="com.goshop.catalog.rest.resource.CommonResource" scope="prototype">
        <property name="storeEntityDAO" ref="storeEntityDAO"/>
        <property name="productEntityDAO" ref="productEntityDAO" />
        <property name="predicateResolver" ref="predicateResolvers" />
        <property name="categoryEntityDAO" ref="categoryEntityDAO" />
        <property name="modelMapper" ref="modelMapperImpl" />
        <property name="pageableResolver" ref="pageableResolver"/>
    </bean>

    <bean id="defaultCategoryResource" class="com.goshop.catalog.rest.resource.CategoryResourceImpl" parent="commonResource">
        <property name="validation" ref="categoryValidation" />
    </bean>

    <bean id="productResource" class="com.goshop.catalog.rest.resource.ProductResourceImpl" parent="commonResource">
        <property name="validation" ref="productValidation" />
    </bean>

    <bean id="categoryValidation" class="com.goshop.catalog.rest.validation.CategoryValidation" parent="commonResource">
        <property name="categoryEntityDAO" ref="categoryEntityDAO" />
    </bean>

    <bean id="productValidation" class="com.goshop.catalog.rest.validation.ProductValidation" parent="commonResource">
        <property name="productEntityDAO" ref="productEntityDAO" />
    </bean>

    <context:component-scan base-package="com.goshop.oom.core.builtin"/>
    <context:component-scan base-package="com.goshop.catalog.rest.mapper"/>
    <context:component-scan base-package="com.goshop.catalog.spec.resource.adapter" />

    <bean id="pageableResolver" class="com.goshop.catalog.rest.resolver.PageableResolverImpl">
        <property name="defaultPageSize" value="20"/>
        <property name="maxPageSize" value="1000"/>
        <property name="sortResolver" ref="sortResolvers"/>
    </bean>

    <bean id="sortResolvers" class="com.goshop.catalog.rest.resolver.SortResolverList">
        <property name="resolvers">
            <list>
                <ref bean="categorySortResolver"/>
            </list>
        </property>
    </bean>

    <bean id="categorySortResolver" class="com.goshop.catalog.rest.resolver.SortResolverImpl">
        <property name="entityClass">
            <value type="java.lang.Class">com.goshop.catalog.db.entity.category.CategoryEntity</value>
        </property>
        <property name="sortableProperties" value="name:name,type,parentCategoryId:parentCategoryId"/>
    </bean>

    <bean id="productSortResolver" class="com.goshop.catalog.rest.resolver.SortResolverImpl">
        <property name="entityClass">
            <value type="java.lang.Class">com.goshop.catalog.db.entity.product.ProductEntity</value>
        </property>
        <property name="sortableProperties" value="name:name" />
    </bean>

    <bean id="predicateResolvers" class="com.goshop.catalog.rest.resolver.PredicateResolverList">
        <property name="resolvers">
            <list>
                <ref bean="categoryPredicateResolver"/>
                <ref bean="productPredicateResolver" />
            </list>
        </property>
    </bean>

    <bean id="categoryPredicateResolver" class="com.goshop.catalog.rest.resolver.CategoryPredicateResolver" />
    <bean id="productPredicateResolver" class="com.goshop.catalog.rest.resolver.ProductPredicateResolver" />
</beans>