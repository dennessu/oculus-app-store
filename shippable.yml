language: java

cache: true

jdk:
  - oraclejdk7

services:
  - couchdb
  - memcached

addons:
  postgresql : "9.3"

branches:
  only:
    - release
    - master

install:
  - true # bypass default gradle action

before_script:
  - ./setupdb.sh

script:
  - GRADLE_OPTS="$GRADLE_OPTS -Xmx2048m -XX:MaxPermSize=512m" ./build.sh -x build
  - ./dataloader.sh
  - ./test.sh -r
#  - docker/images/onebox-app/ci_buildimageandpush.sh

after_script:
  - rm -r -f apphost/apphost-cli/build/install/apphost-cli/bin/apphost/logs
  - rm -r -f apphost/apphost-cli/build/install/apphost-cli/bin/apphost/activemq-data

notifications:
  email:
   recipients:
     - txchen@silkcloud.com
   on_success: always
   on_failure: always

commit_container: silkcloud/apphost
