language: java

cache: true

jdk:
  - oraclejdk7

# DH_EMAIL DH_PASSWORD DH_USERNAME
env:
  global:
    - secure: K/QRY0csysFqdGevv3xCTvbz55u2z/DBa1tAbCziN7s2ksPrp8cPw8rfqzT7X4Q1eNxkRYSAfurLl8DpYTxNFKCKTqOruiTW5ZsMNSEZetW64a4kBfzD2gqoMZBDKGjq8pGJ9Myf+wsz9ErDdoiy0R03FavK4u62yFLHbKHsPOPKvWonnNyc+ORCc81KZNjb61QXMqPegFiwpSIsFEZWTdDK787beQMtkvFk2yfyytJOZ+DjT0pq3hPuNKVNq3b3GUvBWTMVdx4Jijsab/CgUHrSkAVt32tVHw06UcIbuAAg1ebgO7GjhywcI6S2QRE9ovHIW9YV/CBnkHom5E5goA==

services:
  - couchdb
  - memcached

addons:
  postgresql : "9.3"

branches:
  only:
    - release
    - master

# by default shippable minion has no docker, so install it
before_install:
  - curl -sSL https://get.docker.com/ubuntu/ | sudo sh

install:
  - true # bypass default gradle action

#before_script:
#  - ./setupdb.sh

script:
#  - GRADLE_OPTS="$GRADLE_OPTS -Xmx2048m -XX:MaxPermSize=512m" ./build.sh -x build
#  - ./dataloader.sh
#  - ./test.sh -r
  - sudo docker/images/onebox-app/ci_buildimageandpush.sh

notifications:
  email:
   recipients:
     - txchen@silkcloud.com
   on_success: always
   on_failure: always
