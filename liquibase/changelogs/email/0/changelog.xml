<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="1" author='weijiang' context="PREDEPLOY">
        <sql>
            <![CDATA[
            create table email_history(
                id bigint not null,
                user_id bigint,
                source varchar(64) not null,
                action varchar(64) not null,
                locale varchar(32),
                payload varchar(4000),
                recipients varchar(512),
                status smallint,
                status_reason varchar(256),
                retry_count smallint,
                priority smallint,
                sent_time timestamp,
                is_resend boolean,

                created_by varchar(32),
                created_time timestamp,
                modified_by varchar(32),
                modified_time timestamp,

                primary key(id)
            );

            create index email_history_user_id_idx on  email_history (user_id);

            create table email_schedule(
                id bigint not null,
                user_id bigint,
                source varchar(64),
                action varchar(64),
                locale varchar(64),
                payload varchar(4000),
                recipients varchar(512),
                priority smallint,
                schedule_time timestamp,

                created_by varchar(32),
                created_time timestamp,
                modified_by varchar(32),
                modified_time timestamp,

                primary key(id)
            );

            create index email_schedule_schedule_time_idx on  email_schedule (schedule_time);
        ]]>
        </sql>
    </changeSet>
</databaseChangeLog>