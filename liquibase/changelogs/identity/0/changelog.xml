<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="0.1" author='minhao' context="PREDEPLOY">
        <sql><![CDATA[
            create table group_entity(
                id bigint not null,
                
				value varchar(255) not null,
				active boolean not null, 
				
				version bigint not null,
				created_time timestamp,
				created_by varchar(255),
				modified_time timestamp,
				modified_by varchar(255),
				
                primary key(id)
            );
			
			create table user_password (
				id bigint not null,
				user_id bigint not null,
				password_hash varchar(255) not null,
				password_salt varchar(255) not null,
				password_strength smallint not null,
				
				active boolean not null,
				change_at_next_login boolean not null,
				expires_by timestamp not null,
				
				version bigint not null,
				created_by varchar(32) not null,
				created_time timestamp not null,
				modified_time timestamp,
				modified_by varchar(255),
				
				primary key(id)
			);
			
			create table user_pin (
				id bigint not null,
				user_id bigint not null,
				pin_hash varchar(255) not null,
				pin_salt varchar(255) not null,
				
				active boolean not null,
				change_at_next_login boolean not null,
				expires_by timestamp not null,
				
				version bigint not null,
				created_by varchar(32) not null,
				created_time timestamp not null,
				modified_time timestamp,
				modified_by varchar(255),
				
				primary key(id)
			);

			create table user_authenticator(
                id bigint not null,
				
			    version bigint not null,
				user_id bigint not null,
                type varchar(255) not null,
                value varchar(512) not null,

                created_by varchar(32) not null,
                created_time timestamp not null,
                modified_by varchar(32),
                modified_time timestamp,
			  
                primary key(id)
            );
						
            create table user_device (
              id bigint not null,
			  version bigint not null,
              user_id bigint not null,
			  
              type varchar(10) not null ,
              device_id bigint not null,
			  name varchar(255) not null,
			  os varchar(255) not null,
			  
              created_by varchar(32) not null,
              created_time timestamp not null,
			  modified_by varchar(32),
			  modified_time timestamp,

              primary key (id)
            );
			
			create table user_email (
              id bigint not null,
			  version bigint not null,
              user_id bigint not null,
			  
			  value varchar(255) not null,
			  type varchar(255) not null,
			  is_primary boolean not null,
			  is_verified boolean not null,
              
              created_by varchar(32) not null,
              created_time timestamp not null,
			  modified_by varchar(32),
			  modified_time timestamp,

              primary key (id)
            );
			
			create table user_group (
              id bigint not null,
			  version bigint not null,
              user_id bigint not null,
			  group_id bigint not null,
			  
              created_by varchar(32) not null,
              created_time timestamp not null,
			  modified_by varchar(32),
			  modified_time timestamp,

              primary key (id)
            );
			
			create table group_user (
              id bigint not null,
			  version bigint not null,
              user_id bigint not null,
			  group_id bigint not null,
			  
              created_by varchar(32) not null,
              created_time timestamp not null,
			  modified_by varchar(32),
			  modified_time timestamp,

              primary key (id)
            );
			
			create table user_login_attempt (
              id bigint not null,
			  version bigint not null,
              user_id bigint not null,
			  
			  type varchar(255) not null,
			  ip_address varchar(255) not null,
			  user_agent varchar(255) not null,
			  client_id varchar(255) not null,
			  succeeded boolean not null,
			  
              created_by varchar(32) not null,
              created_time timestamp not null,
			  modified_by varchar(32),
			  modified_time timestamp,

              primary key (id)
            );
			
            create table user_optin (
              id bigint not null,
              
			  version bigint not null,
			  user_id bigint not null,
              type varchar(255) not null ,

              created_by varchar(32) not null,
              created_time timestamp not null,
              modified_by varchar(32),
              modified_time timestamp,

              primary key (id)
            );
			
			create table user_phone_number (
              id bigint not null,
              
			  version bigint not null,
			  user_id bigint not null,

		      type varchar(255) not null,
              value varchar(255) not null,
			  is_primary boolean not null,
			  is_verified boolean not null,

              created_by varchar(32) not null,
              created_time timestamp not null,
              modified_by varchar(32),
              modified_time timestamp,

              primary key (id)
            );
			
			create table user_account (
              id bigint not null,
              
			  version bigint not null,

			  user_name varchar(255) not null,
			  nick_name varchar(255) not null,
			  preferred_language varchar(255) not null,
			  locale varchar(255) not null,
			  time_zone varchar(255) not null,
			  is_active boolean not null,
			  birthday varchar(255) not null,
			  gender varchar(255) not null,
			  type varchar(255) not null,
			  
              created_by varchar(32) not null,
              created_time timestamp not null,
              modified_by varchar(32),
              modified_time timestamp,

              primary key (id)
            );
			
			create table user_name (
              id bigint not null,

			  user_id bigint not null,

		      first_name varchar(255) not null,
			  middle_name varchar(255) not null,
			  last_name varchar(255) not null,
			  honorific_prefix varchar(255) not null,
			  honorific_suffix varchar(255) not null,

              primary key (id)
            );
			
			create table user_security_question (
              id bigint not null,
              
			  version bigint not null,
			  user_id bigint not null,

		      security_question_id bigint not null,
			  answer_salt varchar(255) not null,
			  answer_hash varchar(255) not null,

              created_by varchar(32) not null,
              created_time timestamp not null,
              modified_by varchar(32),
              modified_time timestamp,

              primary key (id)
            );
			
			create table user_tos (
              id bigint not null,
			  version bigint not null,
              user_id bigint not null,
              tos_uri varchar(2000) not null,
              
              created_by varchar(32) not null,
              created_time timestamp not null,
              modified_by varchar(32),
              modified_time timestamp,

              primary key (id)
            );

        ]]></sql>
    </changeSet>

</databaseChangeLog>