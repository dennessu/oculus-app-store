<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="0.1" author='minhao' context="PREDEPLOY">
        <sql><![CDATA[
            create table group_entity(
                id bigint not null,
                
				value varchar(255) not null,
				active boolean not null, 
				
				version bigint not null,
				created_time timestamp,
				created_by varchar(255),
				modified_time timestamp,
				modified_by varchar(255),
				
                primary key(id)
            );
			
			create table user_password (
				id bigint not null,
				user_id bigint not null,
				password_hash text not null,
				password_salt text not null,
				password_pepper text not null,
				password_strength smallint not null,
				
				active boolean not null,
				change_at_next_login boolean,
				expires_by timestamp,
				
				version bigint not null,
				created_by varchar(32) not null,
				created_time timestamp not null,
				modified_time timestamp,
				modified_by varchar(255),
				
				primary key(id)
			);
			
			create table user_pin (
				id bigint not null,
				user_id bigint not null,
				pin_hash text not null,
				pin_salt text not null,
				pin_pepper text not null,
				
				active boolean not null,
				change_at_next_login boolean,
				expires_by timestamp,
				
				version bigint not null,
				created_by varchar(32) not null,
				created_time timestamp not null,
				modified_time timestamp,
				modified_by varchar(255),
				
				primary key(id)
			);

			create table user_authenticator(
                id bigint not null,
				
			    version bigint not null,
				user_id bigint not null,
                type varchar(255) not null,
                value varchar(512) not null,

                created_by varchar(32) not null,
                created_time timestamp not null,
                modified_by varchar(32),
                modified_time timestamp,
			  
                primary key(id)
            );
						
            create table user_device (
              id bigint not null,
			  version bigint not null,
              user_id bigint not null,
              device_id bigint not null,
			  
              created_by varchar(32) not null,
              created_time timestamp not null,
			  modified_by varchar(32),
			  modified_time timestamp,

              primary key (id)
            );
			
			create table user_email (
              id bigint not null,
			  version bigint not null,
              user_pii_id bigint not null,
			  
			  value varchar(255) not null,
			  type varchar(255) not null,
			  is_verified boolean not null,
              
              created_by varchar(32) not null,
              created_time timestamp not null,
			  modified_by varchar(32),
			  modified_time timestamp,

              primary key (id)
            );
			
			create table user_group (
              id bigint not null,
			  version bigint not null,
              user_id bigint not null,
			  group_id bigint not null,
			  
              created_by varchar(32) not null,
              created_time timestamp not null,
			  modified_by varchar(32),
			  modified_time timestamp,

              primary key (id)
            );
			
			create table group_user (
              id bigint not null,
			  version bigint not null,
              user_id bigint not null,
			  group_id bigint not null,
			  
              created_by varchar(32) not null,
              created_time timestamp not null,
			  modified_by varchar(32),
			  modified_time timestamp,

              primary key (id)
            );
			
			create table user_login_attempt (
              id bigint not null,
			  version bigint not null,
              user_id bigint not null,
			  
			  type varchar(255) not null,
			  ip_address varchar(255) not null,
			  user_agent varchar(255) not null,
			  client_id varchar(255) not null,
			  succeeded boolean not null,
			  
              created_by varchar(32) not null,
              created_time timestamp not null,
			  modified_by varchar(32),
			  modified_time timestamp,

              primary key (id)
            );
			
            create table user_optin (
              id bigint not null,
              
			  version bigint not null,
			  user_id bigint not null,
              type varchar(255) not null ,

              created_by varchar(32) not null,
              created_time timestamp not null,
              modified_by varchar(32),
              modified_time timestamp,

              primary key (id)
            );
			
			create table user_phone_number (
              id bigint not null,
              
			  version bigint not null,
			  user_pii_id bigint not null,

		      type varchar(255) not null,
              value varchar(255) not null,
			  is_verified boolean not null,

              created_by varchar(32) not null,
              created_time timestamp not null,
              modified_by varchar(32),
              modified_time timestamp,

              primary key (id)
            );
			
			create table user_account (
              id bigint not null,
              
			  version bigint not null,

			  user_name varchar(255) not null,
			  canonical_username varchar(255) not null,
			  nick_name varchar(255),
			  preferred_language varchar(255),
			  locale varchar(255),
			  time_zone varchar(255),
			  is_active boolean not null,
			  type varchar(255) not null,
			  currency varchar(10),
			  
              created_by varchar(32) not null,
              created_time timestamp not null,
              modified_by varchar(32),
              modified_time timestamp,

              primary key (id)
            );
			
			create table user_name (
              id bigint not null,

			  user_id bigint not null,

		      first_name varchar(255) not null,
			  middle_name varchar(255),
			  last_name varchar(255) not null,
			  honorific_prefix varchar(255),
			  honorific_suffix varchar(255),

              primary key (id)
            );
			
			create table user_security_question (
              id bigint not null,
              
			  version bigint not null,
			  user_id bigint not null,

		      security_question text not null,
			  answer_salt text not null,
			  answer_pepper text not null,
			  answer_hash text not null,

              created_by varchar(32) not null,
              created_time timestamp not null,
              modified_by varchar(32),
              modified_time timestamp,

              primary key (id)
            );
			
			create table user_tos (
              id bigint not null,
			  version bigint not null,
              user_id bigint not null,
              tos_id bigint not null,
              
              created_by varchar(32) not null,
              created_time timestamp not null,
              modified_by varchar(32),
              modified_time timestamp,

              primary key (id)
            );

			create table user_security_question_attempt (
			  id bigint not null,
			  user_id bigint not null,
			  user_security_question_id bigint not null,
			  ip_address varchar(255) not null,
			  user_agent varchar(255) not null,
			  client_id varchar(255) not null,
			  succeeded boolean not null,
			  
			  version bigint not null,
              created_by varchar(32) not null,
              created_time timestamp not null,
              modified_by varchar(32),
              modified_time timestamp,
			  
			  primary key (id)
			);
            
            create table device (
             id bigint not null,
             
             external_ref varchar(255) not null,
             description varchar(255) not null,
             
            version bigint not null,
            created_time timestamp,
            created_by varchar(255),
            modified_time timestamp,
            modified_by varchar(255),
             
             primary key (id)
            );

            CREATE TABLE role (
                id BIGINT NOT NULL,
                name VARCHAR(256) NOT NULL,
                resource_type VARCHAR(256),
                resource_id BIGINT,
                sub_resource_type VARCHAR(256),
                active BOOLEAN,
                version BIGINT NOT NULL,
                created_time TIMESTAMP,
                created_by VARCHAR(256),
                modified_time TIMESTAMP,
                modified_by VARCHAR(256),
                PRIMARY KEY(id)
            );

            CREATE TABLE role_assignment (
                id BIGINT NOT NULL,
                role_id BIGINT NOT NULL,
                assignee_type VARCHAR(256),
                assignee_id BIGINT,
                sub_resource_type VARCHAR(256),
                active BOOLEAN,
                version BIGINT NOT NULL,
                created_time TIMESTAMP,
                created_by VARCHAR(256),
                modified_time TIMESTAMP,
                modified_by VARCHAR(256),
                PRIMARY KEY(id)
            );
            
            create table tos (
             id bigint not null,
             
             locale varchar(32) not null,
             title varchar(255) not null,
			 content text not null, 
             
            version bigint not null,
            created_time timestamp,
            created_by varchar(255),
            modified_time timestamp,
            modified_by varchar(255),
             
             primary key (id)
            );
			
			create table user_pii (
				id bigint not null,
				
				user_id bigint not null,
				display_name_type integer not null,
				gender varchar(32),
				birthday timestamp,
				
				version bigint not null,
				created_time timestamp,
				created_by varchar(255),
				modified_time timestamp,
				modified_by varchar(255),
				
				primary key (id)
			);
        ]]></sql>
    </changeSet>

</databaseChangeLog>